# Ch4 - 컨테이너를 실행해 보자

# 1. 도커 엔진 시작/종료하기

## 도커 엔진을 시작/종료하는 방법

- 도커 엔진은 설치와 함께 실행되며, 계속 동작 상태로 남아있지만 컨테이너를 실행 중이 아니라면 컴퓨터의 리소스를 거의 차지하지 않으므로 문제가 없다.
- 도커 데스크톱은 도커 엔진을 자동으로 실행하도록 설정되어 있기 때문에 부팅될 때마다 자동으로 실행된다.
- 리눅스에서는 자동 실행이 기본 설정이 아니다.
    - 실제 사용할 때 곤란해지기 쉬우므로 자동 실행을 설정해놓자.
- 컨테이너는 따로 실행해야 한다.

### 리눅스에서

- 도커 엔진 시작

```bash
sudo systemctl start docker
```

- 도커 엔진 종료

```bash
sudo systemctl stop docker
```

- 자동 실행 설정

```bash
sudo systemctl enable docker
```

# 2. 컨테이너의 기본적인 사용 방법

## 컨테이너 사용의 기본은 도커 명령어

- 컨테이너를 다루는 모든 명령은 ‘docker’ 명령어로 시작한다.

```docker
docker ~
```

### 명령어와 대상

- docker 명령어 뒤에 오는 ‘무엇을’ ‘어떻게’에 해당하는 부분을 `커맨드`라고 한다.
- `커맨드`는 `상위 커맨드`와 `하위 커맨드`로 구성되며, `상위 커맨드`가 ‘무엇을’, `하위 커맨드`가 ‘어떻게’에 해당하는 내용을 지정한다.
- 또 ‘대상’에는 컨테이너명 또는 이미지명 등 구체적인 이름이 들어간다.
- 즉 `docker ‘무엇을’ ‘어떻게’ ‘대상’` 형식으로 지정하면 된다.
- ex) 이름이 penguin인 이미지를 실행

```docker
docker container run penguin
```

- 상위 커맨드는 container 또는 image와 같이 대상의 종류가 들어간다.
- 대상에 해당하는 부분에는 구체적인 이름을 지정한다.
- ex) penguin 이미지를 내려받기

```docker
docker image pull penguin
```

- ex) penguin 이미지로 컨테이너를 시작하기

```docker
docker container start penguin
```

### 옵션과 인자

- 명령어의 기본적인 형태는 `docker [커맨드] [대상]`이지만 `옵션`과 `인자`라는 추가 정보가 붙는다.

```docker
docker container run -d penguin --mode=1
```

- -d: 옵션 → 백그라운드로 실행하라
- —mode=1: 인자 → 모드 1로 실행하라

## 기본적인 명령어 - 정리

- docker 명령어의 기본적인 형태

```docker
docker 커맨드 (옵션) 대상 (인자)
```

### 커맨드

- start나 run처럼 ‘container’를 붙이지 않아도 실행 가능한 명령어가 있으며, 관례상 이쪽을 사용하는 경우가 많다.

```docker
docker container run
docker run
```

### 옵션

- 커맨드에 세세한 설정을 지정하는 용도로 쓰인다.
- 백그라운드로 실행할 때는 -d, 키보드를 통해 조작하고 싶다면 -i 또는 -t를 붙이는 등, 커맨드의 실행 방법 또는 커맨드에 전달할 값을 지정한다.
- 옵션은 커맨드에 따라 달라진다.
- - 또는 —으로 시작하는 것이 일반적이지만 - 기호를 붙이지 않는 경우도 있다.
- -나 — 중 무엇을 사용할지는 커맨드 작성자의 취향이므로 명확한 기준은 없다.

```docker
-d
--all

# 어떤 값을 전달하고 싶다면 --name 같은 옵션 뒤에 옵션의 값을 지정한다
--name penguin

# -d -i -t 옵션을 한꺼번에 모아 쓸 수도 있다.
-dit
```

### 대상

- 커맨드와 달리 구체적인 이름을 지정한다.

### 인자

- 대상에 전달할 값을 지정한다.
    - 문자 코드 또는 포트 번호 등을 전달할 수 있다.
- 인자를 지정하는 경우는 그리 많지 않다.

## 상위 커맨드는 생략 가능하다?

- 도커 1.13부터 커맨드가 재편되면서 상위 커맨드와 하위 커맨드의 조합 형태로 일원화되었다.
    - 일부 커맨드는 커맨드 자체가 변경되기도 했다.
- 이전 커맨드와의 호환성을 유지하기 위해 상위 커맨드 없이 실행 가능하지만 언제 수정될지 모르는 기능이니 상위 커맨드가 있다는 것 정도는 기억해 두자.

## 대표적인 명령어

### 컨테이너 조작 관련 커맨드(상위 커맨드 container)

```docker
docker container 하위_커맨드 옵션
```

| 하위 커맨드 | 내용 | 생략 가능 여부 | 주요 옵션 |
| --- | --- | --- | --- |
| start | 컨테이너를 실행 | O | -i |
| stop | 컨테이너를 정지 | O | 거의 사용하지 않음 |
| create | 도커 이미지로부터 컨테이너를 생성 | O | —name -e -p -v |
| run | 도커 이미지를 내려받고 컨테이너를 생성해 실행(다운로드는 필요한 경우에만). docker image pull, docker container create, docker container start라는 세 개의 명령을 하나로 합친 것 같다. | O | —name -e -p -v -d -i -t |
| rm | 정지 상태의 컨테이너를 삭제 | O | -f -v |
| exec | 실행 중인 컨테이너 속에서 프로그램을 실행 | O | -i -t |
| ls | 컨테이너 목록을 출력 | docker ps | -a |
| cp | 도커 컨테이너와 도커 호스트 간에 파일을 복사 | O | 거의 사용하지 않음 |
| commit | 도커 컨테이너를 이미지로 반환 | O | 거의 사용하지 않음 |

### 이미지 조작 관련 커맨드(상위 커맨드 image)

```docker
docker image 하위_커맨드 옵션
```

| 하위 커맨드 | 내용 | 생략 가능 여부 | 주요 옵션 |
| --- | --- | --- | --- |
| pull | 도커 허브 등의 리포지토리에서 이미지를 내려받음 | O | 거의 사용하지 않음 |
| rm | 도커 이미지를 삭제 | docker rmi | 거의 사용하지 않음 |
| ls | 내려받은 이미지의 목록을 출력 | X | 거의 사용하지 않음 |
| build | 도커 이미지를 생성 | O | -t |

### 볼륨 조작 관련 커맨드(상위 커맨드 volume)

```docker
docker volume 하위_커맨드 옵션
```

| 하위 커맨드 | 내용 | 생략 가능 여부 | 주요 옵션 |
| --- | --- | --- | --- |
| create | 볼륨을 생성 | X | —name |
| inspect | 볼륨의 상세 정보를 출력 | X | 거의 사용하지 않음 |
| ls | 볼륨의 목록을 출력 | X | -a |
| prune | 현재 마운트되지 않은 볼륨을 모두 삭제 | X | 거의 사용하지 않음 |
| rm | 지정한 볼륨을 삭제 | X | 거의 사용하지 않음 |

### 네트워크 조작 관련 커맨드(상위 커맨드 network)

- 도커 네트워크란 도커 요소 간의 통신에 사용하는 가상 네트워크를 가리킨다.

```docker
docker network 하위_커맨드 옵션
```

| 하위 커맨드 | 내용 | 생략 가능 여부 | 주요 옵션 |
| --- | --- | --- | --- |
| connect | 컨테이너를 도커 네트워크에 연결 | X | 거의 사용하지 않음 |
| disconnect | 컨테이너의 도커 네트워크 연결을 해제 | X | 거의 사용하지 않음 |
| create | 도커 네트워크를 생성 | X | 거의 사용하지 않음 |
| inspect | 도커 네트워크의 상세 정보를 출력 | X | 거의 사용하지 않음 |
| ls | 도커 네트워크의 목록을 출력 | X | 거의 사용하지 않음 |
| prune | 현재 컨테이너가 접속하지 않은 네트워크를 모두 삭제 | X | 거의 사용하지 않음 |
| rm | 지정한 네트워크를 삭제 | X | 거의 사용하지 않음 |

### 그 밖의 상위 커맨드

- 도커 스웜과 관련된 커맨드로서 초보자 수준에서 사용할 일은 없다.

| 상위 커맨드 | 내용 |
| --- | --- |
| checkpoint | 현재 상태를 일시적으로 저장한 후, 나중에 해당 시점의 상태로 되돌릴 수 있다. 현재 실험적 기능이다. |
| node | 도커 스웜의 노드를 관리하는 기능 |
| plugin | 플러그인을 관리하는 기능 |
| secret | 도커 스웜의 비밀값 정보를 관리하는 기능 |
| service | 도커 스웜의 서비스를 관리하는 기능 |
| stack | 도커 스웜 또는 쿠버네티스에서 여러 개의 서비스를 합쳐 구성한 스택을 관리하는 기능 |
| swarm | 도커 스웜을 관리하는 기능 |
| system | 도커 엔진의 정보를 확인하는 기능 |

### 상위 커맨드 없이 단독으로 쓰이는 커맨드

| 단독 커맨드 | 내용 | 주요 옵션 |
| --- | --- | --- |
| login | 도커 레지스트리에 로그인 | -u -p |
| logout | 도커 레지스트리에 로그아웃 | 거의 사용하지 않음 |
| search | 도커 레지스트리를 검색 | 거의 사용하지 않음 |
| version | 도커 엔진 및 명령행 도구의 버전을 출력 | 거의 사용하지 않음 |

# 3. 컨테이너의 생성과 삭제, 실행, 정지

## docker run 커맨드와 docker stop, docker rm 커맨드

- 컨테이너를 실행할 때는 docker run 커맨드를 사용한다.
- 컨테이너의 생애주기
    - 생성(create) → 실행(start) → 정지(stop) → 폐기(rm)
- 동작 중인 컨테이너를 그대로 삭제할 수는 없기 때문에 컨테이너를 폐기하려면 먼저 정지시켜야 한다.
- 컨테이너를 정지시키려면 docker stop, 컨테이너를 삭제하려면 docker rm 커맨드를 사용한다.

### 컨테이너를 생성하고 실행하는 커맨드: docker run(docker container run)

- 컨테이너의 이름은 —name 옵션, 포트 번호는 -p, 볼륨을 마운트할 때는 -v, 컨테이너를 연결할 네트워크는 —net 옵션 등을 사용할 수 있다.
- 데몬 형태로 동작하는 소프트웨어의 컨테이너는 -d, -i, -t 옵션을 사용하는 경우가 많으며 이들 옵션은 -dit와 같이 합쳐서 사용하면 편리하다.
- 사용할 수 있는 인자는 이미지의 종류에 따라 달라진다.

```docker
docker run (옵션) 이미지 (인자)
```

- 주요 옵션

| 옵션 형식 | 내용 |
| --- | --- |
| —name 컨테이너_이름 | 컨테이너 이름을 지정함 |
| -p 호스트_포트번호:컨테이너_포트번호 | 포트 번호를 지정함 |
| -v 호스트_디스크:컨테이너_디렉토리 | 볼륨을 마운트함 |
| —net=네트워크_이름 | 컨테이너를 네트워크에 연결함 |
| -e 환경변수_이름=값 | 환경변수를 설정함 |
| -d | 백그라운드로 실행함 |
| -i | 컨테이너에 터미널(키보드)을 연결함 |
| -t | 특수 키를 사용 가능하도록 함 |
| -help | 사용 방법 안내 메시지를 출력함 |
- -p는 —publish, -v는 —volume, -e는 —env, -d는 —detach, -i는 —interactive, -t는 —tty의 생략형이다.

### 컨테이너를 정지하는 커맨드: docker stop(docker container stop)

- 이 커맨드에서는 옵션이나 인자를 지정하는 경우가 별로 없다.

```docker
docker stop 컨테이너_이름
```

### 컨테이너를 삭제하는 커맨드: docker rm(docker container rm)

- 마찬가지로 옵션이나 인자를 지정하는 경우가 별로 없다.

```docker
docker rm 컨테이너_이름
```

## 한 번만 실행되는 컨테이너와 데몬 형태로 동작하는 컨테이너

- 컨테이너는 제각각 내용이 다르다. 그런만큼 컨테이너에 따라 지정 가능한 옵션이나 인자가 달라진다.
    - 여러가지 옵션을 지정할 수 있는 컨테이너가 있는가 하면, 그렇지 않은 것도 있다.
- docker run 옵션에서 사용하는 -d, -i, -t 옵션은 자주 쓰이는 반면, 사용하지 않을 때도 많다.
- -d는 컨테이너를 백그라운드로 실행, -i와 -t는 컨테이너 내부에 터미널로 접속하기 위해 사용하는 옵션이다.
    - -d를 붙이지 않고 컨테이너를 실행하면 실행된 컨테이너가 프로그램의 실행을 마칠 때까지 터미널의 제어를 차지하므로 그 다음 명령을 입력할 수 없는 상태가 된다.
    - -i, -t 옵션을 붙이지 않으면 컨테이너 안의 파일 시스템에 접근할 수 없다.
- 모두 당연히 사용해야 하는 옵션 같지만 사용할 때도 있고 그렇지 않을 때도 있다.
    - 왜냐하면 컨테이너에는 `한 번만 실행되는 컨테이너`와 `데몬 형태로 동작하는 컨테이너`가 있기 때문이다.
- 한 번만 실행되는 컨테이너는 실행하자마자 종료되므로 컨테이너가 터미널의 제어를 차지하더라도 일시적인 것이므로 문제가 되지 않는다.
- 그러나 데몬처럼 계속 실행되는 프로그램은 저절로 종료되지 않으므로 한 번 터미널의 제어를 넘기면 이를 되찾아 오기가 번거롭다.
- 또한 컨테이너 속 파일 시스템을 다루려면 -i 또는 -t 옵션을 사용해야 하지만 실행하자마자 종료되는 컨테이너라면 컨테이너 속 파일 시스템에 손 댈 일 없으므로 불필요한 옵션이 된다.

### 데몬

- 유닉스 또는 리눅스에서 동작하는 프로그램 중에서 백그라운드에서 항상 동작하는 프로그램을 관례적으로 **데몬**이라고 한다.

## docker ps 커맨드

- 컨테이너의 생애주기를 관장하는 커맨드 외에 자주 사용하게 될 커맨드가 한 가지 더 있는데, 이 커맨드가 바로 `docker ps(docker container ls)` 커맨드다.
- 이 커맨드는 컨테이너의 목록을 출력하는 기능을 한다.
    - `docker ps`는 현재 실행 중인 컨테이너의 목록을 출력하며, `docker ps -a`는 정지 상태의 컨테이너를 포함한 목록을 출력한다.

```docker
docker ps (옵션)
```

- 컨테이너를 실행하거나 정지시킬 때 컨테이너의 상태가 기대했던 대로인지 확인할 수도 있으며, 컨테이너의 상세정보를 확인할 때도 사용한다.

### 컨테이너 목록의 정보

- `docker ps`를 실행하면
    - 첫 번째 행은 각 항목의 이름이 출력되며, 두 번째 행부터 실제 컨테이너 정보가 출력된다.

```docker
CONTAINER ID   IMAGE     COMMAND              CREATED         STATUS         PORTS     NAMES
4e8a8963ff2c   httpd     "httpd-foreground"   6 seconds ago   Up 5 seconds   80/tcp    apa000ex1
```

| CONTAINER ID | 컨테이너 식별자. 원래 64글자이지만 앞 12글자만 출력한다. |
| --- | --- |
| IMAGE | 컨테이너를 만들 때 사용한 이미지의 이름 |
| COMMAND | 컨테이너 실행 시에 실행하도록 설정된 프로그램의 이름 |
| CREATED | 컨테이너 생성 후 경과된 시간 |
| STATUS | 컨테이너의 현재 상태. 실행중이면 ‘Up’, 종료된 상태라면 ‘Exited’ |
| PORTS | 컨테이너에 할당된 포트 번호. ‘호스트 포트 번호 → 컨테이너 포트 번호’ 형식으로 출력된다. 포트 번호가 동일할 경우 → 뒷부분은 출력되지 않는다. |
| NAMES | 컨테이너 이름 |

## [실습] 컨테이너를 생성하고, 실행, 상태, 종료, 삭제해 보자

- 아파치 컨테이너로 실습. 이미지 이름은 httpd이다.

### run 커맨드 실행

```docker
docker run --name apa000ex1 -d httpd
```

| --name apa000ex1 | ‘apa000ex1’라는 이름으로 컨테이너 생성 |
| --- | --- |
| -d | 백그라운드로 실행 |
| httpd | 아파치의 이미지 이름. 버전을 지정하지 않았으므로 최신 버전이 사용된다. |

### stop 커맨드를 사용해 컨테이너 종료

```docker
docker stop apa000ex1

# 실행 결과
apa000ex1
```

### ps 커맨드와 인자를 사용해 컨테이너의 존재 여부 확인

```docker
docker ps -a

# 실행 결과
CONTAINER ID   IMAGE     COMMAND              CREATED         STATUS                      PORTS     NAMES
4e8a8963ff2c   httpd     "httpd-foreground"   5 minutes ago   Exited (0) 37 seconds ago             apa000ex1
```

### rm 커맨드를 사용해 컨테이너 삭제

```docker
docker rm apa000ex1

# 실행 결과
apa000ex1
```

- 삭제 후 `docker ps -a`를 입력하면 목록에 나오지 않는다.

## 컨테이너 ID의 식별자 이용하기

- `stop`이나 `rm`처럼 이미 생성된 컨테이너의 이름을 지정해야 하는 커맨드는 컨테이너 ID와 그 생략형으로도 실행할 수 있다.
    - 컨테이너 ID가 2bdbaFb4022라면 `docker stop 2b`라고 입력해도 컨테이너를 종료시킬 수 있다.

# 4. 컨테이너의 통신

## 아파치란?

- 아파치는 웹 서버 기능을 제공하는 소프트웨어다.
- 웹 브라우저를 통해 컨테이너에 접근이 가능하게 하려면 컨테이너를 실행할 때 설정이 필요하다.
    - 이 설정은 컨테이너를 생성한 후에는 기본적으로 변경할 수 없다.
    - 따라서 `docker run`에 옵션 형태로 설정한다.

## 컨테이너와 통신하려면

- 웹 브라우저를 통해 컨테이너에 접근하려면 외부와 접속하기 위한 설정이 필요하다. 이를 위해 포트를 설정한다.
    - 포트란 통신 내용이 드나드는 통로이다.
- 아파치는 서버에서 정해둔 포트(80번 포트)에서 웹 사이트에 대한 접근을 기다리다가 사용자가 이 포트를 통해 접근해 오면 요청에 따라 웹 사이트의 페이지를 제공한다. 하지만 컨테이너 속에서 실행 중인 아파치는 외부와 직접 연결되지 않았기 때문에 외부에서 접근할 수 없다.
- 그래서 컨테이너를 실행 중인 물리적 컴퓨터가 외부의 접근을 대신 받아 전달해주도록 한다.
    - 컨테이너를 실행 중인 컴퓨터(호스트)의 8080번 포트와 컨테이너의 80번 포트를 연결한다.
- 이 설정이 `-p` 옵션이며, 그 뒤로 ‘호스트의 포트 번호’와 ‘컨테이너의 포트 번호를’ 콜론으로 연결해 함께 기재한다.

```docker
-p 8080:80
```

- 컨테이너를 사용하면 여러 개의 웹 서버를 함께 실행할 수 있다.
- 이러한 경우 호스트 포트 번호를 모두 같은 것으로 사용하면 어떤 컨테이너로 가야 할 요청인지 구분할 수 없기 대문에 컨테이너 A에는 호스트 포트 8080, 컨테이너 B에는 호스트 포트 8081과 같은 식으로 호스트의 포트 번호를 겹치지 않게 설정한다.
- 여러 컨테이너로 연결되는 포트를 같게 설정하고 싶다면 리버스 프록시로 서비스 이름을 통해 구분하도록 구성한다.

## [실습] 통신이 가능한 컨테이너 생성

- 포트 번호 설정을 추가해서 외부에서 접근할 수 있는 아파치 컨테이너를 만들어 보자.

### run

```docker
docker run --name apa000ex2 -d -p 8080:80 httpd

# 실행 결과
2381f58da7b9ba8b50f1a14ea03806ef8ecc23d8ed70212bfcf15acdb6cd253a
```

- 이후 생략

# 5. 컨테이너 생성에 익숙해지기

### 리눅스 운영체제가 담긴 컨테이너

| 이미지 이름 | 컨테이너의 내용 | 컨테이너 실행에 주로 사용되는 옵션 및 인자 |
| --- | --- | --- |
| ubuntu | 우분투 | -d 없이 -it 옵션만 사용. 인자로는 /bin/bash 등 셸 명령어를 지정한다. |
| centos | CentOS | -d 없이 -it 옵션만 사용. 인자로는 /bin/bash 등 셸 명령어를 지정한다. |
| debian | 데비안 | -d 없이 -it 옵션만 사용. 인자로는 /bin/bash 등 셸 명령어를 지정한다. |
| fedora | 페도라 | -d 없이 -it 옵션만 사용. 인자로는 /bin/bash 등 셸 명령어를 지정한다. |
| busybox | BizyBox | -d 없이 -it 옵션만 사용. 인자로는 /bin/bash 등 셸 명령어를 지정한다. |
| alpne | 알파인 리눅스 | -d 없이 -it 옵션만 사용. 인자로는 /bin/bash 등 셸 명령어를 지정한다. |

### 웹 서버/데이터베이스 서버용 컨테이너

- 웹 서버 소프트웨어는 Apache 외에도 Nginx가 유명하다.
- 웹 서버는 통신이 전제가 되므로 옵션을 통해 포트 번호를 지정해야 한다.
- 데이터베이스 서버는 MySQL 외에 PostgreSQL이나 MariaDB도 유명하다. 데이터베이스 관리 소프트웨어는 기본적으로 **루트 패스워드**를 반드시 지정해야 한다.

| 이미지 이름 | 컨테이너의 내용 | 컨테이너 실행에 주로 사용되는 옵션 및 인자 |
| --- | --- | --- |
| httpd | Apache | -d로 백그라운드로 실행. -p로 포트 번호 지정 |
| nginx | Nginx | -d로 백그라운드로 실행. -p로 포트 번호 지정 |
| mysql | MySQL | -d를 사용. 실행 시 -e MYSQL_ROOT_PASSWORD와 같이 루트 패스워드를 지정 |
| postgres | PostgreSQL | -d를 사용. 실행 시 -e POSTGRES_ROOT_PASSWORD와 같이 루트 패스워드를 지정 |
| mariaDB | MariaDB | -d를 사용. 실행 시 -e MYSQL_ROOT_PASSWORD와 같이 루트 패스워드를 지정 |

### 프로그램 실행을 위한 런타임과 그 외 소프트웨어

- 프로그램을 실행하려면 해당 언어의 실행 환경인 런타임이 필요하다.

| 이미지 이름 | 컨테이너의 내용 | 컨테이너 실행에 주로 사용되는 옵션 및 인자 |
| --- | --- | --- |
| openjdk | 자바 런타임 | -d를 사용하지 않고, 인자로 java 명령 등을 지정해 도구 형태로 사용한다. |
| python | 파이썬 런타임 | -d를 사용하지 않고, 인자로 python 명령 등을 지정해 도구 형태로 사용한다. |
| gcc | C/C++ 컴파일러 | -d를 사용하지 않고, 인자로 gcc 명령 등을 지정해 도구 형태로 사용한다. |
| node | Node.js | -d를 사용하지 않고, 인자로 app 명령 등을 지정해 도구 형태로 사용한다. |
| registry | 도커 레지스트리 | -d 옵션을 사용해 백그라운드로 실행하며, -p 옵션으로 포트 번호를 지정한다. |
| wordpress | WordPress | -d 옵션을 사용해 백그라운드로 실행하며, -p 옵션으로 포트 번호를 지정한다. MySQL 또는 MariaDB가 필요하다. 접속에 필요한 패스워드는 -e 옵션으로 지정한다. |

## 아파치 컨테이너를 여러 개 실행하기

- 컨테이너를 여러 개 실행할 때 호스트 컴퓨터의 포트 번호가 중복되어서는 안 된다.
- 컨테이너 포트는 중복되어도 무방하므로 모두 80번으로 설정한다.
    - 이 포트 번호는 이미지 제작자가 지정한 것으로 변경할 수 없다.

### run

```docker
docker run --name apa000ex3 -d -p 8081:80 httpd
docker run --name apa000ex4 -d -p 8082:80 httpd
docker run --name apa000ex5 -d -p 8083:80 httpd
```

## 컨테이너 ID

- 컨테이너마다 ID가 부여되기 때문에 이름이 없어도 컨테이너를 지정할 수 있다. `docker run`을 실행했을 때 출력되는 문자열이 바로 컨테이너 ID이다.

```docker
2381f58da7b9ba8b50f1a14ea03806ef8ecc23d8ed70212bfcf15acdb6cd253a
```

- 문자열의 길이가 상당하기 때문에 실제로는 `docker ps` 커맨드의 출력 결과중 CONTAINER ID 항목에 출력되는 문자열을 사용한다.

```docker
CONTAINER ID ...
2381f58da7b9 ...
```

- 단, 그래도 무작위 문자열이라 시각적으로 구분하기 쉽지 않으므로 컨테이너에 이름을 붙이는 것이 더 낫다.
- 똑같은 소프트웨어의 컨테이너라도 매번 다른 문자열이 할당된다.

## [실습] Nginx 컨테이너 실행하기

### run

```docker
docker run --name nginx000ex6 -d -p 8084:80 nginx
```

### ps

```docker
CONTAINER ID   IMAGE     COMMAND                   CREATED          STATUS          PORTS                  NAMES
973abfc6805a   nginx     "/docker-entrypoint.…"   15 seconds ago   Up 14 seconds   0.0.0.0:8084->80/tcp   nginx000ex6
```

## [실습] MySQL 컨테이너 실행하기

- MySQL은 WordPress와 함께 쓰인다.
- 제대로 동작하게 하려면 인자를 반드시 지정해야 한다.

### run

```docker
docker run --name mysql000ex7 -dit -e MYSQL_ROOT_PASSWORD=myrootpass mysql
```

### ps

```docker
CONTAINER ID   IMAGE     COMMAND                   CREATED          STATUS          PORTS                 NAMES
69e2f960c5df   mysql     "docker-entrypoint.s…"   17 seconds ago   Up 15 seconds   3306/tcp, 33060/tcp   mysql000ex7
```

- MySQL은 루트 패스워드 외에도 문자 인코딩이나 정렬 순서를 결정해야 한다.

## 6. 이미지 삭제

- 컨테이너를 여러 번 만들다 보면 한 가지 문제가 발생한다. 컨테이너를 삭제해도 이미지는 그대로 남아 쌓인다.
- 이미지가 늘어나면 스토리지 용량이 쌓이므로 필요없는 이미지는 그때그때 삭제한다.
- 이미지를 삭제할 때는 이미지ID 또는 이미지 이름으로 지정한다.
- 해당 이미지로 실행한 컨테이너가 남아 있으면 이미지를 삭제할 수 없으므로 `docker ps -a`와 같이 컨테이너 목록을 출력해 확인하고 컨테이너 종료 및 삭제하고 이미지를 삭제한다.

## docker image rm 커맨드

- 이 커맨드는 `docker rm`과 같이 생략할 수 없다. 이것은 `docker container rm`의 생략형이기 때문이다.
- 옵션이나 인자를 사용하지 않는 경우가 많다.

```docker
docker image rm 이미지_이름

#여러 개의 이미지 지정
docker image rm 이미지_이름 이미지_이름 이미지_이름...
```

## docker image ls 커맨드

- 이미지 목록을 확인할 수 있다.
- ps와 달리 -a 옵션은 사용할 수 없다.
    - 컨테이너와 달리 ‘실행 중’, ‘종료’ 등상태를 가질 수 없기 때문이다.

### 이미지 목록의 정보

- 이미지 이름과 태그(버전 정보), ID 등의 정보를 확인할 수 있다.

```docker
REPOSITORY   TAG       IMAGE ID       CREATED       SIZE
httpd        latest    faf1e61d1928   2 weeks ago   195MB
nginx        latest    ab73c7fd6723   2 weeks ago   192MB
mysql        latest    bdfb0ec4d54a   3 weeks ago   599MB
```

| REPOSITORY | 이미지 이름 |
| --- | --- |
| TAG | 버전 정보. 따로 지정하지 않으면 최신 버전을 내려받는다. |
| IMAGE ID | 이미지 식별자. 원래 64글자이지만 앞 12글자만 출력한다. |
| CREATED | 이미지 생성 후 경과된 시간. |
| SIZE | 컨테이너의 현재 상태. 실행중이면 ‘Up’, 종료된 상태라면 ‘Exited’ |

## 이미지 버전과 이미지 이름

- 시스템 구성에 따라 이미지의 특정 버전을 사용해야 할 때도 있다.
- 버전을 지정하는 포맷
    - `이미지_이름:버전_넘버`

```docker
# 아파지 버전 2.2를 지정해 컨테이너를 실행
docker run --name apa000ex2 -d -p 8080:80 httpd:2.2

# 아파치 2.2 이미지 삭제
docker image rm httpd:2.2
```

## [실습] 이미지 삭제하기

- 먼저 ps 커맨드로 컨테이너가 있는지 확인한다.

### image rm

```docker
docker image rm httpd nginx mysql
```

- 특정 버전을 지정할 때는 TAG 항목에 출력되는 버전을 사용한다.